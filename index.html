<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>üî• Dragon's Crypt</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --main-bg: #1a1a2e;
            --accent: #ff6b6b;
        }

        body {
            background: var(--main-bg);
            color: white;
            font-family: 'Courier New', monospace;
        }

        .game-container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }

        .pixel-art {
            image-rendering: pixelated;
        }

        .dialog-box {
            border: 3px solid var(--accent);
            padding: 15px;
            margin: 20px 0;
            background: rgba(0,0,0,0.7);
            position: relative;
        }

        .choice-btn {
            background: #4a4a6d;
            border: 2px solid var(--accent);
            color: white;
            margin: 5px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .choice-btn:hover {
            transform: scale(1.05);
            background: var(--accent);
        }

        #map {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 5px;
            margin: 20px 0;
        }

        .map-tile {
            aspect-ratio: 1;
            background: #2d2d44;
            border: 1px solid var(--accent);
            position: relative;
        }

        .player-icon {
            width: 80%;
            height: 80%;
            background: var(--accent);
            position: absolute;
            top: 10%;
            left: 10%;
            clip-path: polygon(50% 0%, 100% 38%, 82% 100%, 18% 100%, 0% 38%);
        }
    </style>
</head>
<body>
    <div class="game-container">
        <h1>üêâ Dragon's Crypt</h1>
        
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–∞—Ä—Ç–∞ -->
        <div id="map"></div>

        <!-- –î–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ -->
        <div class="dialog-box" id="dialog">
            <div id="dialog-text">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–æ–¥–∑–µ–º–µ–ª—å–µ, –∏—Å–∫–∞—Ç–µ–ª—å –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–π!</div>
            <div id="choices"></div>
        </div>

        <!-- –°—Ç–∞—Ç—É—Å–Ω–∞—è –ø–∞–Ω–µ–ª—å -->
        <div id="status">
            ‚öîÔ∏è –£—Ä–æ–≤–µ–Ω—å: <span id="level">1</span> 
            ‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ: <span id="health">100</span>/100
            üí∞ –ó–æ–ª–æ—Ç–æ: <span id="gold">50</span>
        </div>
    </div>

    <script>
        const tg = Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText("–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å").hide();
        
        // –ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
        const gameState = {
            level: 1,
            health: 100,
            gold: 50,
            position: {x: 2, y: 2},
            inventory: [],
            discoveredRooms: new Set()
        };

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function generateMap() {
            const map = document.getElementById('map');
            map.innerHTML = '';
            
            for(let y = 0; y < 5; y++) {
                for(let x = 0; x < 5; x++) {
                    const tile = document.createElement('div');
                    tile.className = 'map-tile';
                    if(x === gameState.position.x && y === gameState.position.y) {
                        const player = document.createElement('div');
                        player.className = 'player-icon';
                        tile.appendChild(player);
                    }
                    tile.onclick = () => movePlayer(x, y);
                    map.appendChild(tile);
                }
            }
        }

        // –ú–µ—Ö–∞–Ω–∏–∫–∞ –¥–≤–∏–∂–µ–Ω–∏—è
        function movePlayer(x, y) {
            if(Math.abs(x - gameState.position.x) > 1 || 
               Math.abs(y - gameState.position.y) > 1) return;
            
            gameState.position = {x, y};
            generateMap();
            discoverRoom();
        }

        // –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
        function discoverRoom() {
            const roomId = `${gameState.position.x}-${gameState.position.y}`;
            if(!gameState.discoveredRooms.has(roomId)) {
                gameState.discoveredRooms.add(roomId);
                showRandomEvent();
            }
        }

        // –°–ª—É—á–∞–π–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
        function showRandomEvent() {
            const events = [
                {
                    text: "–í—ã –Ω–∞—à–ª–∏ —Å—É–Ω–¥—É–∫! –ß—Ç–æ –±—É–¥–µ—Ç–µ –¥–µ–ª–∞—Ç—å?",
                    choices: [
                        {text: "–û—Ç–∫—Ä—ã—Ç—å", action: () => findLoot()},
                        {text: "–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞ –ª–æ–≤—É—à–∫–∏", action: () => checkForTraps()},
                        {text: "–£–π—Ç–∏", action: () => closeDialog()}
                    ]
                },
                {
                    text: "–ù–∞ –≤–∞—Å –Ω–∞–ø–∞–ª üßü –°–∫–µ–ª–µ—Ç-–≤–æ–∏–Ω!",
                    choices: [
                        {text: "‚öîÔ∏è –ê—Ç–∞–∫–æ–≤–∞—Ç—å", action: () => startCombat()},
                        {text: "üõ°Ô∏è –ó–∞—â–∏—â–∞—Ç—å—Å—è", action: () => defend()},
                        {text: "üèÉ –ë–µ–∂–∞—Ç—å", action: () => tryEscape()}
                    ]
                }
            ];
            
            const event = events[Math.floor(Math.random() * events.length)];
            showDialog(event.text, event.choices);
        }

        // –°–∏—Å—Ç–µ–º–∞ –¥–∏–∞–ª–æ–≥–æ–≤
        function showDialog(text, choices) {
            document.getElementById('dialog-text').textContent = text;
            const choicesContainer = document.getElementById('choices');
            choicesContainer.innerHTML = choices.map(choice => `
                <button class="choice-btn" onclick="choice.action()">${choice.text}</button>
            `).join('');
        }

        // –ü—Ä–∏–º–µ—Ä –∏–≥—Ä–æ–≤–æ–π –º–µ—Ö–∞–Ω–∏–∫–∏: –±–æ–π
        function startCombat() {
            const enemyHP = gameState.level * 20;
            let currentEnemyHP = enemyHP;
            
            showDialog(`‚öîÔ∏è –ë–æ–π –Ω–∞—á–∞–ª—Å—è! (–ó–¥–æ—Ä–æ–≤—å–µ –≤—Ä–∞–≥–∞: ${currentEnemyHP})`, [
                {
                    text: "–£–¥–∞—Ä –º–µ—á–æ–º",
                    action: () => {
                        const damage = Math.floor(Math.random() * 15) + 5;
                        currentEnemyHP -= damage;
                        if(currentEnemyHP <= 0) {
                            const goldEarned = Math.floor(Math.random() * 50) + 10;
                            gameState.gold += goldEarned;
                            showDialog(`–í—ã –ø–æ–±–µ–¥–∏–ª–∏! –ü–æ–ª—É—á–µ–Ω–æ ü™ô ${goldEarned} –∑–æ–ª–æ—Ç–∞`, [
                                {text: "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å", action: closeDialog}
                            ]);
                        } else {
                            showDialog(`–í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${damage} —É—Ä–æ–Ω–∞! (–û—Å—Ç–∞–ª–æ—Å—å HP: ${currentEnemyHP})`, [
                                {text: "–ê—Ç–∞–∫–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞", action: () => startCombat()}
                            ]);
                        }
                    }
                }
            ]);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        generateMap();
        tg.ready();

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —á–µ—Ä–µ–∑ Telegram
        function saveProgress() {
            Telegram.WebApp.sendData(JSON.stringify(gameState));
            Telegram.WebApp.close();
        }
    </script>
</body>
</html>
