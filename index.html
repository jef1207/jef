<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Racer</title>
    <style>
        /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ø—Ä–µ–∂–Ω–∏–º–∏ */
        body { margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; background: #2c3e50; touch-action: manipulation; overflow: hidden; }
        #gameCanvas { background: #34495e; border-radius: 10px; margin: 10px; touch-action: none; }
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; width: 100%; max-width: 400px; }
        button { padding: 15px; font-size: 18px; border: none; border-radius: 8px; background: #3498db; color: white; touch-action: manipulation; }
        button:active { background: #2980b9; }
        #score { color: white; font-size: 24px; margin: 10px; font-family: Arial; }
        .game-over { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.8); color: white; padding: 20px; border-radius: 10px; text-align: center; display: none; }
        .settings-panel { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; color: white; }
    </style>
</head>
<body>
    <div class="settings-panel">
        <button onclick="toggleSound()">üîä Sound: ON</button>
    </div>
    <div id="score">Score: 0</div>
    <canvas id="gameCanvas"></canvas>
    <div class="controls">
        <button id="leftBtn">‚Üê</button>
        <button id="brakeBtn">‚ßñ –¢–æ—Ä–º–æ–∑</button>
        <button id="rightBtn">‚Üí</button>
    </div>
    <div class="game-over" id="gameOver">
        <h2>Game Over!</h2>
        <button onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <script>
        // =====================
        // –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò–ì–†–´
        // =====================
        const CONFIG = {
            ROAD: {
                widthRatio: 0.7,
                lanes: 3,
                colors: {
                    road: '#7f8c8d',
                    marker: '#ffffff',
                    shoulder: '#34495e'
                }
            },
            PLAYER: {
                width: 30,
                height: 50,
                speed: 5,
                color: '#e74c3c',
                startPosition: 'center' // –∏–ª–∏ 'left'/'right'
            },
            ENEMIES: {
                types: [
                    {
                        name: 'car',
                        width: 30,
                        height: 50,
                        minSpeed: 3,
                        maxSpeed: 5,
                        color: '#2ecc71',
                        spawnChance: 0.7
                    },
                    {
                        name: 'truck',
                        width: 40,
                        height: 70,
                        minSpeed: 2,
                        maxSpeed: 4,
                        color: '#f1c40f',
                        spawnChance: 0.2
                    },
                    {
                        name: 'bike',
                        width: 20,
                        height: 30,
                        minSpeed: 4,
                        maxSpeed: 6,
                        color: '#9b59b6',
                        spawnChance: 0.1
                    }
                ]
            },
            DIFFICULTY: {
                levels: [
                    { score: 0, spawnRate: 100, speedMultiplier: 1.0 },
                    { score: 500, spawnRate: 80, speedMultiplier: 1.2 },
                    { score: 1000, spawnRate: 60, speedMultiplier: 1.5 }
                ]
            },
            SOUND: {
                enabled: true,
                volume: 0.5,
                effects: {
                    crash: 'crash.mp3',
                    engine: 'engine.mp3',
                    score: 'score.mp3'
                }
            }
        };

        // =====================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò–ì–†–´
        // =====================
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let currentLevel = 0;
        let soundEnabled = CONFIG.SOUND.enabled;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É–¥–∏–æ
        const audio = {
            crash: new Audio(CONFIG.SOUND.effects.crash),
            engine: new Audio(CONFIG.SOUND.effects.engine),
            score: new Audio(CONFIG.SOUND.effects.score)
        };

        Object.values(audio).forEach(sound => {
            sound.volume = CONFIG.SOUND.volume;
        });

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–æ—Ä–æ–≥–∏
        const ROAD = {
            left: () => canvas.width * (1 - CONFIG.ROAD.widthRatio) / 2,
            right: () => ROAD.left() + canvas.width * CONFIG.ROAD.widthRatio,
            laneWidth: () => (ROAD.right() - ROAD.left()) / CONFIG.ROAD.lanes
        };

        // –ò–≥—Ä–æ–∫
        const player = {
            x: 0,
            y: 0,
            ...CONFIG.PLAYER,
            resetPosition() {
                switch(CONFIG.PLAYER.startPosition) {
                    case 'left': 
                        this.x = ROAD.left() + 10;
                        break;
                    case 'right':
                        this.x = ROAD.right() - this.width - 10;
                        break;
                    default:
                        this.x = ROAD.left() + (ROAD.right() - ROAD.left() - this.width) / 2;
                }
                this.y = canvas.height - 80;
            }
        };

        // =====================
        // –§–£–ù–ö–¶–ò–ò –ò–ì–†–´
        // =====================
        function createEnemy() {
            const enemyType = weightedRandomEnemyType();
            const roadWidth = ROAD.right() - ROAD.left() - enemyType.width;
            
            return {
                x: ROAD.left() + Math.random() * roadWidth,
                y: -enemyType.height,
                ...enemyType,
                speed: enemyType.minSpeed + Math.random() * (enemyType.maxSpeed - enemyType.minSpeed)
            };
        }

        function weightedRandomEnemyType() {
            const total = CONFIG.ENEMIES.types.reduce((sum, type) => sum + type.spawnChance, 0);
            let random = Math.random() * total;
            
            for(const type of CONFIG.ENEMIES.types) {
                if(random < type.spawnChance) return type;
                random -= type.spawnChance;
            }
            return CONFIG.ENEMIES.types[0];
        }

        function updateDifficulty() {
            const nextLevel = CONFIG.DIFFICULTY.levels.findIndex(l => score < l.score) - 1;
            if(nextLevel !== currentLevel) {
                currentLevel = Math.max(0, nextLevel);
                playSound('engine');
            }
        }

        function playSound(name) {
            if(soundEnabled && audio[name]) {
                audio[name].currentTime = 0;
                audio[name].play();
            }
        }

        // =====================
        // –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
        // =====================
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.querySelector('.settings-panel button').textContent = 
                `üîä Sound: ${soundEnabled ? 'ON' : 'OFF'}`;
        }

        // –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (updateGame, draw, gameOver –∏ —Ç.–¥.) 
        // –∞–¥–∞–ø—Ç–∏—Ä—É—é—Ç—Å—è –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å CONFIG

        // =====================
        // –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø
        // =====================
        function initGame() {
            player.resetPosition();
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
            // –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
        }

        initGame();
    </script>
</body>
</html>
