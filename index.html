<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—å—é–ø–æ—Ä—Ç–∞ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>–ì–æ–Ω–∫–∏ —Å —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º</title>
    <style>
        /* CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ª–µ–≥–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–≤–µ—Ç–æ–≤ */
        :root {
            --primary-color: #e74c3c;    /* –¶–≤–µ—Ç –∏–≥—Ä–æ–∫–∞ */
            --road-color: #7f8c8d;       /* –¶–≤–µ—Ç –¥–æ—Ä–æ–≥–∏ */
            --bg-color: #2c3e50;         /* –§–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
            --text-color: #ecf0f1;       /* –¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ */
            --button-bg: #3498db;        /* –¶–≤–µ—Ç –∫–Ω–æ–ø–æ–∫ */
        }

        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: var(--bg-color);
            color: var(--text-color);
            touch-action: pan-x pan-y;   /* –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑—É–º–∞, —Ä–∞–∑—Ä–µ—à–∞–µ–º —Ç–æ–ª—å–∫–æ —Å–∫—Ä–æ–ª–ª */
            min-height: 100dvh;          /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –Ω–∞ –≤—Å—é –≤–∏–¥–∏–º—É—é –æ–±–ª–∞—Å—Ç—å */
            font-family: 'Arial', sans-serif;
            -webkit-user-select: none;   /* –ó–∞–ø—Ä–µ—Ç –≤—ã–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ */
            user-select: none;
        }

        #gameContainer {
            position: relative;
            width: 100%;
            flex-grow: 1;
            max-width: 600px;            /* –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∏–≥—Ä–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏ */
        }

        #gameCanvas {
            display: block;
            background: var(--road-color);
            touch-action: none;          /* –û—Ç–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–∞—Å–∞–Ω–∏–π –±—Ä–∞—É–∑–µ—Ä–æ–º */
            width: 100%;
            height: 70vh;                /* 70% –≤—ã—Å–æ—Ç—ã —ç–∫—Ä–∞–Ω–∞ */
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            padding: 1rem;
            width: 100%;
            max-width: 600px;
            box-sizing: border-box;
        }

        .control-btn {
            padding: 1rem;
            font-size: 1.5rem;
            border: 2px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            background: var(--button-bg);
            color: white;
            transition: transform 0.1s;  /* –ê–Ω–∏–º–∞—Ü–∏—è –Ω–∞–∂–∞—Ç–∏—è */
        }

        .control-btn:active {
            transform: scale(0.95);      /* –≠—Ñ—Ñ–µ–∫—Ç –Ω–∞–∂–∞—Ç–∏—è */
        }

        .score-board {
            display: flex;
            gap: 2rem;
            padding: 1rem;
            font-size: 1.2rem;
        }

        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
            display: none;
        }

        /* –°–∫—Ä—ã—Ç—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0,0,0,0);
            border: 0;
        }
    </style>
</head>
<body>
    <!-- –®–∞–ø–∫–∞ —Å —Å—á–µ—Ç–æ–º -->
    <header role="banner">
        <div class="score-board">
            <div>–°—á—ë—Ç: <span id="currentScore" aria-live="polite">0</span></div>
            <div>–†–µ–∫–æ—Ä–¥: <span id="bestScore" aria-live="polite">0</span></div>
        </div>
    </header>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–≥—Ä–æ–≤–∞—è –æ–±–ª–∞—Å—Ç—å -->
    <main id="gameContainer" role="main">
        <canvas id="gameCanvas" aria-label="–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ —Å –¥–≤–∏–∂—É—â–µ–π—Å—è –º–∞—à–∏–Ω–∫–æ–π">
            <p>–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Canvas. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ–±–Ω–æ–≤–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä.</p>
        </canvas>
        
        <!-- –≠–∫—Ä–∞–Ω Game Over -->
        <div class="game-over" id="gameOver" role="alert">
            <h2>–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞!</h2>
            <button class="control-btn" onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
    </main>

    <!-- –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
    <footer role="contentinfo">
        <div class="controls">
            <button 
                id="leftBtn" 
                class="control-btn"
                aria-label="–î–≤–∏–∂–µ–Ω–∏–µ –≤–ª–µ–≤–æ"
                onpointerdown="startMove(-1)"
                onpointerup="stopMove()"
                onpointercancel="stopMove()">
                ‚Üê
            </button>
            
            <button 
                id="soundBtn" 
                class="control-btn"
                aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∑–≤—É–∫"
                onclick="toggleSound()">
                <span aria-hidden="true">üîä</span>
                <span class="sr-only">–ó–≤—É–∫:</span>
                <span id="soundState">–í–∫–ª</span>
            </button>
            
            <button 
                id="rightBtn" 
                class="control-btn"
                aria-label="–î–≤–∏–∂–µ–Ω–∏–µ –≤–ø—Ä–∞–≤–æ"
                onpointerdown="startMove(1)"
                onpointerup="stopMove()"
                onpointercancel="stopMove()">
                ‚Üí
            </button>
        </div>
    </footer>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let enemies = [];                // –ú–∞—Å—Å–∏–≤ –≤—Ä–∞–∂–µ—Å–∫–∏—Ö –º–∞—à–∏–Ω
        let score = 0;                   // –¢–µ–∫—É—â–∏–π —Å—á–µ—Ç
        let bestScore = localStorage.getItem('bestScore') || 0; // –õ—É—á—à–∏–π —Å—á–µ—Ç
        let isGameOver = false;          // –§–ª–∞–≥ –æ–∫–æ–Ω—á–∞–Ω–∏—è –∏–≥—Ä—ã
        let soundEnabled = true;         // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∑–≤—É–∫–∞
        let lastTime = 0;                // –í—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–∞–¥—Ä–∞
        let animationFrameId;            // ID –∞–Ω–∏–º–∞—Ü–∏–∏

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã
        const CONFIG = {
            ROAD: {
                widthRatio: 0.8,         // –®–∏—Ä–∏–Ω–∞ –¥–æ—Ä–æ–≥–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —ç–∫—Ä–∞–Ω–∞
                lanes: 4,               // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ª–æ—Å
                dash: [50, 30]          // –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–µ—Ä—ã–≤–∏—Å—Ç–æ–π –ª–∏–Ω–∏–∏
            },
            PLAYER: {
                maxSpeed: 8,            // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
                acceleration: 0.2,      // –£—Å–∫–æ—Ä–µ–Ω–∏–µ
                friction: 0.08,         // –¢—Ä–µ–Ω–∏–µ
                width: 40,              // –ù–∞—á–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞
                height: 60              // –ù–∞—á–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞
            },
            ENEMY: {
                spawnRate: 2000,        // –ò–Ω—Ç–µ—Ä–≤–∞–ª —Å–ø–∞–≤–Ω–∞ (–º—Å)
                speed: 3,               // –ë–∞–∑–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
                minSpeed: 2,            // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
                maxSpeed: 5             // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
            }
        };

        // –û–±—ä–µ–∫—Ç –∏–≥—Ä–æ–∫–∞
        const player = {
            x: 0,
            y: 0,
            lane: 1,                    // –¢–µ–∫—É—â–∞—è –ø–æ–ª–æ—Å–∞ (0-3)
            speed: 0,                   // –¢–µ–∫—É—â–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å
            targetLane: 1,              // –¶–µ–ª–µ–≤–∞—è –ø–æ–ª–æ—Å–∞
            updatePosition(deltaTime) {
                // –ü–ª–∞–≤–Ω–æ–µ –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –º–µ–∂–¥—É –ø–æ–ª–æ—Å–∞–º–∏
                const targetX = getLaneCenter(this.targetLane);
                const dx = targetX - this.x;
                
                // –†–∞—Å—á–µ—Ç —É—Å–∫–æ—Ä–µ–Ω–∏—è –∏ —Ç—Ä–µ–Ω–∏—è
                if(Math.abs(dx) > 1) {
                    this.speed += CONFIG.PLAYER.acceleration * Math.sign(dx) * deltaTime;
                    this.speed = Math.max(-CONFIG.PLAYER.maxSpeed, 
                                       Math.min(CONFIG.PLAYER.maxSpeed, this.speed));
                } else {
                    this.speed *= (1 - CONFIG.PLAYER.friction);
                }
                
                // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–∑–∏—Ü–∏–∏
                this.x += this.speed * deltaTime;
                
                // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ—Ä–æ–≥–∏
                const minX = getLaneCenter(0) - CONFIG.PLAYER.width/2;
                const maxX = getLaneCenter(3) - CONFIG.PLAYER.width/2;
                this.x = Math.max(minX, Math.min(maxX, this.x));
                
                // –ü–æ–∑–∏—Ü–∏—è –ø–æ Y (—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–∞ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞)
                this.y = canvas.height - CONFIG.PLAYER.height * 1.5;
            }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
        function init() {
            resizeCanvas();
            player.updatePosition(0);
            window.addEventListener('resize', resizeCanvas);
            document.getElementById('bestScore').textContent = Math.floor(bestScore/100);
            startGame();
        }

        // –ó–∞–ø—É—Å–∫ –Ω–æ–≤–æ–π –∏–≥—Ä—ã
        function startGame() {
            isGameOver = false;
            score = 0;
            enemies = [];
            player.lane = 1;
            player.targetLane = 1;
            lastTime = 0;
            if (animationFrameId) cancelAnimationFrame(animationFrameId);
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–≤ –æ–∫–Ω–∞
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight * 0.7;
            CONFIG.PLAYER.width = canvas.width * 0.07;
            CONFIG.PLAYER.height = canvas.width * 0.12;
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –¥–æ—Ä–æ–≥–∏
        function drawRoad() {
            ctx.fillStyle = '#7f8c8d';
            const roadWidth = canvas.width * CONFIG.ROAD.widthRatio;
            const roadLeft = (canvas.width - roadWidth) / 2;
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –ø–æ–ª–æ—Ç–Ω–∞ –¥–æ—Ä–æ–≥–∏
            ctx.fillRect(roadLeft, 0, roadWidth, canvas.height);

            // –†–∞–∑–º–µ—Ç–∫–∞ –ø–æ–ª–æ—Å
            ctx.strokeStyle = '#ffffff';
            ctx.setLineDash(CONFIG.ROAD.dash);
            ctx.lineWidth = 4;
            
            for(let i = 1; i < CONFIG.ROAD.lanes; i++) {
                const x = roadLeft + (roadWidth / CONFIG.ROAD.lanes) * i;
                ctx.beginPath();
                ctx.moveTo(x, 0);
                ctx.lineTo(x, canvas.height);
                ctx.stroke();
            }
        }

        // –ì–ª–∞–≤–Ω—ã–π –∏–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª
        function gameLoop(timestamp) {
            const deltaTime = timestamp - lastTime;
            lastTime = timestamp;

            if (!isGameOver) {
                updateGame(deltaTime);
                draw();
            }
            
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function updateGame(deltaTime) {
            // –î–≤–∏–∂–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
            enemies.forEach(enemy => {
                enemy.y += enemy.speed * deltaTime / 16;
            });

            // –°–ø–∞–≤–Ω –Ω–æ–≤—ã—Ö –≤—Ä–∞–≥–æ–≤
            if (Math.random() < deltaTime / CONFIG.ENEMY.spawnRate) {
                spawnEnemy();
            }

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
            if (checkCollision()) {
                gameOver();
                return;
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞
            score += deltaTime / 16;
            document.getElementById('currentScore').textContent = Math.floor(score/100);
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤
        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawRoad();

            // –ò–≥—Ä–æ–∫
            ctx.fillStyle = '#e74c3c';
            ctx.fillRect(
                player.x, 
                player.y, 
                CONFIG.PLAYER.width, 
                CONFIG.PLAYER.height
            );

            // –í—Ä–∞–≥–∏
            ctx.fillStyle = '#2ecc71';
            enemies.forEach(enemy => {
                ctx.fillRect(
                    enemy.x, 
                    enemy.y, 
                    CONFIG.PLAYER.width, 
                    CONFIG.PLAYER.height
                );
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
        let isMoving = false;
        window.startMove = function(direction) {
            if (isGameOver) return;
            isMoving = true;
            player.targetLane = Math.max(0, 
                Math.min(3, player.targetLane + direction));
        };

        window.stopMove = function() {
            isMoving = false;
        };

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞
        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundState').textContent = 
                soundEnabled ? '–í–∫–ª' : '–í—ã–∫–ª';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏–π
        function checkCollision() {
            const playerRect = {
                x: player.x,
                y: player.y,
                width: CONFIG.PLAYER.width,
                height: CONFIG.PLAYER.height
            };

            return enemies.some(enemy => {
                const enemyRect = {
                    x: enemy.x,
                    y: enemy.y,
                    width: CONFIG.PLAYER.width,
                    height: CONFIG.PLAYER.height
                };

                return !(playerRect.x > enemyRect.x + enemyRect.width ||
                       playerRect.x + playerRect.width < enemyRect.x ||
                       playerRect.y > enemyRect.y + enemyRect.height ||
                       playerRect.y + playerRect.height < enemyRect.y);
            });
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã
        function gameOver() {
            isGameOver = true;
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('bestScore', bestScore);
                document.getElementById('bestScore').textContent = Math.floor(bestScore/100);
            }
            document.getElementById('gameOver').style.display = 'block';
            if (navigator.vibrate) navigator.vibrate(200);
            cancelAnimationFrame(animationFrameId);
        }

        // –†–µ—Å—Ç–∞—Ä—Ç –∏–≥—Ä—ã
        function restartGame() {
            document.getElementById('gameOver').style.display = 'none';
            startGame();
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function getLaneCenter(lane) {
            const roadWidth = canvas.width * CONFIG.ROAD.widthRatio;
            const laneWidth = roadWidth / CONFIG.ROAD.lanes;
            return (canvas.width - roadWidth)/2 + laneWidth * (lane + 0.5);
        }

        function spawnEnemy() {
            enemies.push({
                lane: Math.floor(Math.random() * 4),
                x: getLaneCenter(Math.floor(Math.random() * 4)) - CONFIG.PLAYER.width/2,
                y: -CONFIG.PLAYER.height,
                speed: CONFIG.ENEMY.minSpeed + 
                    Math.random() * (CONFIG.ENEMY.maxSpeed - CONFIG.ENEMY.minSpeed)
            });
        }

        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
        document.addEventListener('touchstart', function(e) {
            if(e.touches.length > 1) e.preventDefault();
        }, { passive: false });

        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });

        // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
