<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Racer</title>
    <style>
        body { margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; background: #2c3e50; touch-action: manipulation; overflow: hidden; }
        #gameCanvas { background: #34495e; border-radius: 10px; margin: 10px; touch-action: none; }
        .controls { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 10px; width: 100%; max-width: 400px; }
        button { padding: 15px; font-size: 18px; border: none; border-radius: 8px; background: #3498db; color: white; touch-action: manipulation; }
        button:active { background: #2980b9; }
        #score { color: white; font-size: 24px; margin: 10px; font-family: Arial; }
        .game-over { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0, 0, 0, 0.8); color: white; padding: 20px; border-radius: 10px; text-align: center; display: none; }
        .settings-panel { position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 10px; border-radius: 5px; color: white; }
    </style>
</head>
<body>
    <div class="settings-panel">
        <button onclick="toggleSound()">üîä Sound: ON</button>
    </div>
    <div id="score">Score: 0</div>
    <canvas id="gameCanvas"></canvas>
    <div class="controls">
        <button id="leftBtn">‚Üê</button>
        <button id="brakeBtn">‚ßñ –¢–æ—Ä–º–æ–∑</button>
        <button id="rightBtn">‚Üí</button>
    </div>
    <div class="game-over" id="gameOver">
        <h2>Game Over!</h2>
        <button onclick="restartGame()">–ò–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>

    <script>
        const CONFIG = {
            ROAD: {
                widthRatio: 0.7,
                lanes: 3,
                colors: {
                    road: '#7f8c8d',
                    marker: '#ffffff',
                    shoulder: '#34495e'
                }
            },
            PLAYER: {
                width: 30,
                height: 50,
                speed: 5,
                color: '#e74c3c',
                startPosition: 'center'
            },
            ENEMIES: {
                types: [
                    {
                        name: 'car',
                        width: 30,
                        height: 50,
                        minSpeed: 3,
                        maxSpeed: 5,
                        color: '#2ecc71',
                        spawnChance: 0.7
                    }
                ]
            },
            DIFFICULTY: {
                levels: [
                    { score: 0, spawnRate: 100, speedMultiplier: 1.0 }
                ]
            }
        };

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        let enemies = [];
        let score = 0;
        let gameLoop;
        let isGameOver = false;
        let currentLevel = 0;
        let soundEnabled = false;

        const ROAD = {
            left: () => canvas.width * (1 - CONFIG.ROAD.widthRatio) / 2,
            right: () => ROAD.left() + canvas.width * CONFIG.ROAD.widthRatio,
            laneWidth: () => (ROAD.right() - ROAD.left()) / CONFIG.ROAD.lanes
        };

        const player = {
            x: 0,
            y: 0,
            ...CONFIG.PLAYER,
            resetPosition() {
                switch(CONFIG.PLAYER.startPosition) {
                    case 'left': 
                        this.x = ROAD.left() + 10;
                        break;
                    case 'right':
                        this.x = ROAD.right() - this.width - 10;
                        break;
                    default:
                        this.x = ROAD.left() + (ROAD.right() - ROAD.left() - this.width) / 2;
                }
                this.y = canvas.height - 80;
            }
        };

        function resizeCanvas() {
            canvas.width = Math.min(window.innerWidth - 20, 400);
            canvas.height = canvas.width * 0.8;
            player.resetPosition();
            enemies = [];
        }

        function addEventListeners() {
            const leftBtn = document.getElementById('leftBtn');
            const rightBtn = document.getElementById('rightBtn');
            
            leftBtn.addEventListener('touchstart', () => player.moveLeft = true);
            leftBtn.addEventListener('touchend', () => player.moveLeft = false);
            rightBtn.addEventListener('touchstart', () => player.moveRight = true);
            rightBtn.addEventListener('touchend', () => player.moveRight = false);
            
            document.addEventListener('keydown', (e) => {
                if(e.key === 'ArrowLeft') player.moveLeft = true;
                if(e.key === 'ArrowRight') player.moveRight = true;
            });
            
            document.addEventListener('keyup', (e) => {
                if(e.key === 'ArrowLeft') player.moveLeft = false;
                if(e.key === 'ArrowRight') player.moveRight = false;
            });
        }

        function createEnemy() {
            const enemyType = CONFIG.ENEMIES.types[0];
            enemies.push({
                x: ROAD.left() + Math.random() * (ROAD.right() - ROAD.left() - enemyType.width),
                y: -enemyType.height,
                ...enemyType,
                speed: 3
            });
        }

        function checkCollision(rect1, rect2) {
            return rect1.x < rect2.x + rect2.width &&
                   rect1.x + rect1.width > rect2.x &&
                   rect1.y < rect2.y + rect2.height &&
                   rect1.y + rect1.height > rect2.y;
        }

        function updateGame() {
            if(isGameOver) return;

            if(player.moveLeft && player.x > ROAD.left()) player.x -= player.speed;
            if(player.moveRight && player.x < ROAD.right() - player.width) player.x += player.speed;

            enemies.forEach(enemy => {
                enemy.y += enemy.speed;
                if(checkCollision(player, enemy)) gameOver();
            });

            enemies = enemies.filter(enemy => {
                if(enemy.y > canvas.height) {
                    score += 10;
                    document.getElementById('score').textContent = `Score: ${score}`;
                    return false;
                }
                return true;
            });

            if(Math.random() * 100 < 1) createEnemy();
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Road
            ctx.fillStyle = CONFIG.ROAD.colors.road;
            ctx.fillRect(ROAD.left(), 0, ROAD.right() - ROAD.left(), canvas.height);
            
            // Player
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
            
            // Enemies
            enemies.forEach(enemy => {
                ctx.fillStyle = enemy.color;
                ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);
            });
        }

        function gameOver() {
            isGameOver = true;
            document.getElementById('gameOver').style.display = 'block';
            cancelAnimationFrame(gameLoop);
        }

        function restartGame() {
            player.resetPosition();
            enemies = [];
            score = 0;
            isGameOver = false;
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('score').textContent = `Score: 0`;
            gameLoop = requestAnimationFrame(game);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.querySelector('.settings-panel button').textContent = 
                `üîä Sound: ${soundEnabled ? 'ON' : 'OFF'}`;
        }

        function game() {
            updateGame();
            draw();
            gameLoop = requestAnimationFrame(game);
        }

        // Initialization
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        addEventListeners();
        game();
    </script>
</body>
</html>
